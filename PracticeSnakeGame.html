<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>SnakeGame</title>

  <style>
    body {
      font-family: system-ui, sans-serif;
      text-align: center;
      background: #e8fff0;
      padding: 20px;
    }

    #game-wrapper {
      display: inline-block;
      position: relative;
      margin-top: 10px;
    }

    canvas {
      background: #ffffff;
      border: 4px solid #1b1b1b;
      border-radius: 8px;
      box-shadow: 0 0 10px #0003;
    }

    .controls button, .modes button {
      padding: 10px 18px;
      font-size: 15px;
      border: none;
      border-radius: 6px;
      margin: 5px;
      cursor: pointer;
      font-weight: 600;
      color: white;
    }

    #pauseBtn { background:#e67e22; }
    #restartBtn { background:#d9534f; }
    #startBtn { background:#27ae60; }

    .modes button { background:#3498db; }
    .modes button.active { background:#1b70b3; box-shadow:0 0 10px #1b70b3; }

    .info {
      margin-top: 10px;
      font-size: 18px;
      font-weight: 600;
    }

    #overlay {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.55);
      color: white;
      font-size: 42px;
      font-weight: bold;
      display: none;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      backdrop-filter: blur(2px);
    }

    #gameOverText {
      position: absolute;
      inset: 0;
      display: none;
      font-size: 36px;
      color: #e74c3c;
      font-weight: 800;
      backdrop-filter: blur(2px);
      align-items: center;
      justify-content: center;
      animation: pop .4s ease-out;
    }

    @keyframes pop {
      0% { transform: scale(.5); opacity:0; }
      100% { transform: scale(1); opacity:1; }
    }
  </style>
</head>
<body>

  <h1>SNAKE GAME</h1>

  <!-- Difficulty Buttons -->
  <div class="modes">
    <button id="easyBtn">Easy</button>
    <button id="normalBtn" class="active">Normal</button>
    <button id="hardBtn">Hard</button>
  </div>

  <div id="game-wrapper">
    <canvas id="game" width="400" height="400"></canvas>

    <div id="overlay">PAUSED</div>
    <div id="gameOverText"></div>
  </div>

  <div class="controls">
    <button id="startBtn">Start</button>
    <button id="pauseBtn">Pause</button>
    <button id="restartBtn">Restart</button>
  </div>

  <div class="info">
    <span id="score">Score: 0</span> &nbsp; â€¢ &nbsp;
    <span id="high">High: 0</span>
  </div>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    const overlay = document.getElementById('overlay');
    const gameOverText = document.getElementById('gameOverText');

    const startBtn = document.getElementById('startBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const restartBtn = document.getElementById('restartBtn');
    const scoreEl = document.getElementById('score');
    const highEl = document.getElementById('high');

    const easyBtn = document.getElementById('easyBtn');
    const normalBtn = document.getElementById('normalBtn');
    const hardBtn = document.getElementById('hardBtn');

    const CELL = 20;
    const COLS = canvas.width / CELL;
    const ROWS = canvas.height / CELL;

    let snake = [];
    let food = null;

    let dir = { x: 1, y: 0 };
    let nextDir = { x: 1, y: 0 };

    let running = false;
    let paused = false;

    let score = 0;
    let high = parseInt(localStorage.getItem('snake_high') || '0', 10);
    highEl.textContent = "High: " + high;

    // ===============================
    // DIFFICULTY SETTINGS
    // ===============================
    let difficultySpeed = 8; // default normal

    function setDifficulty(speed, button) {
      difficultySpeed = speed;

      // highlight active mode
      [easyBtn, normalBtn, hardBtn].forEach(btn => btn.classList.remove("active"));
      button.classList.add("active");
    }

    easyBtn.onclick = () => setDifficulty(5, easyBtn);
    normalBtn.onclick = () => setDifficulty(8, normalBtn);
    hardBtn.onclick = () => setDifficulty(12, hardBtn);

    let lastTime = 0;
    let accumulator = 0;

    /*============================
      GAME INIT
    ============================*/
    function init() {
      snake = [];
      const len = 5;
      const cx = Math.floor(COLS/2);
      const cy = Math.floor(ROWS/2);

      for (let i = 0; i < len; i++) {
        snake.push({ x: cx - i, y: cy });
      }

      dir = { x: 1, y: 0 };
      nextDir = { x: 1, y: 0 };

      score = 0;
      scoreEl.textContent = "Score: 0";

      spawnFood();
      draw();

      overlay.style.display = "none";
      gameOverText.style.display = "none";
    }

    /*============================
      FOOD
    ============================*/
    function spawnFood() {
      while (true) {
        const fx = Math.floor(Math.random() * COLS);
        const fy = Math.floor(Math.random() * ROWS);
        if (!snake.some(s => s.x === fx && s.y === fy)) {
          food = { x: fx, y: fy };
          return;
        }
      }
    }

    /*============================
      CONTROLS
    ============================*/
    function setDirection(x, y) {
      if (x === -dir.x && y === -dir.y) return;
      nextDir = { x, y };
    }

    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowUp" || e.key === "w") setDirection(0, -1);
      if (e.key === "ArrowDown" || e.key === "s") setDirection(0, 1);
      if (e.key === "ArrowLeft" || e.key === "a") setDirection(-1, 0);
      if (e.key === "ArrowRight" || e.key === "d") setDirection(1, 0);
      if (e.key === " ") togglePause();
    });

    /*============================
      UPDATE
    ============================*/
    function update() {
      dir = nextDir;

      const head = {
        x: snake[0].x + dir.x,
        y: snake[0].y + dir.y
      };

      if (head.x < 0 || head.x >= COLS || head.y < 0 || head.y >= ROWS)
        return gameOver();

      if (snake.some(s => s.x === head.x && s.y === head.y))
        return gameOver();

      snake.unshift(head);

      if (head.x === food.x && head.y === food.y) {
        score++;
        scoreEl.textContent = "Score: " + score;
        spawnFood();
      } else snake.pop();
    }

    /*============================
      DRAW
    ============================*/
    function drawCell(x, y, col) {
      ctx.fillStyle = col;
      ctx.fillRect(x * CELL, y * CELL, CELL, CELL);
    }

    function draw() {
      ctx.clearRect(0,0,canvas.width,canvas.height);

      ctx.beginPath();
      ctx.fillStyle = "#ff4444";
      ctx.arc(food.x*CELL + CELL/2, food.y*CELL + CELL/2, CELL/2-2, 0, Math.PI*2);
      ctx.fill();

      snake.forEach((p,i)=>{
        drawCell(p.x,p.y, i===0 ? "#27ae60":"#2ecc71");
      });
    }

    /*============================
      LOOP
    ============================*/
    function loop(ts) {
      if (!lastTime) lastTime = ts;

      const delta = (ts - lastTime) / 1000;
      lastTime = ts;

      const step = 1 / difficultySpeed; // <-- difficulty applied here

      if (running && !paused) {
        accumulator += delta;

        while (accumulator >= step) {
          update();
          accumulator -= step;
        }

        draw();
      }

      requestAnimationFrame(loop);
    }

    /*============================
      GAME OVER
    ============================*/
    function gameOver() {
      running = false;

      if (score > high) {
        high = score;
        localStorage.setItem("snake_high", high);
        highEl.textContent = "High: " + high;
      }

      gameOverText.innerHTML = `GAME OVER<br>Score: ${score}`;
      gameOverText.style.display = "flex";
    }

    /*============================
      PAUSE
    ============================*/
    function togglePause() {
      if (!running) return;
      paused = !paused;
      overlay.style.display = paused ? "flex" : "none";
      pauseBtn.textContent = paused ? "Resume" : "Pause";
    }

    /*============================
      BUTTONS
    ============================*/
    startBtn.onclick = () => {
      init();
      lastTime = 0;
      running = true;
    };

    restartBtn.onclick = () => {
      init();
      lastTime = 0;
      running = true;
    };

    pauseBtn.onclick = () => togglePause();

    init();
    draw();
    requestAnimationFrame(loop);
  </script>

</body>
</html>
